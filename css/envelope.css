:root{
  --bg:#faf7f2;
  --paper:#ffffff;
  --envelope:#f2e8d9;
  --envelope-shadow:#e8ddcc;
  --flap:#eadcc7;
  --ink:#1b1b1b;
  --dur-1: 450ms;  /* sello fade */
  --dur-2: 800ms;  /* flap abre */
  --dur-3: 900ms;  /* carta sale */
  --delay-s: 120ms;
}

*{ box-sizing:border-box }
html,body{ height:100% }
body{
  margin:0; background:var(--bg); color:var(--ink);
  font-family: system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
  display:grid; min-height:100vh; place-items:center;
}

/* Layout en columna: hint encima, luego la escena (así no se solapa) */
.wrap{
  display:flex; flex-direction:column; align-items:center; gap:12px;
  width:min(92vw, 720px);
}
.hint{
  color:#6b6b6b; font-size:.95rem; text-align:center; line-height:1.2;
}

/* Contenedor de la animación */
.scene{
  position:relative; width:min(92vw,720px); height:min(70vh,520px);
  display:grid; place-items:center; perspective:1200px;
  user-select:none; -webkit-tap-highlight-color:transparent;
  outline:none;
}

/* ENVELOPE */
.envelope{
  position:relative; width:min(86vw,640px); aspect-ratio:4/3; max-height:64vh;
  transform-style:preserve-3d; display:grid; place-items:center;
}
.envelope__body{
  position:absolute; inset:0; border-radius:18px; background:var(--envelope);
  box-shadow: 0 18px 40px rgba(0,0,0,.12), inset 0 -1px 0 var(--envelope-shadow);
  z-index:2;
}
.envelope__flap{
  position:absolute; left:0; right:0; top:0; height:55%; transform-origin:50% 0%;
  background:var(--flap); border-top-left-radius:18px; border-top-right-radius:18px;
  clip-path: polygon(0 0, 100% 0, 50% 100%);
  z-index:3; backface-visibility:hidden; will-change:transform;
  transform:rotateX(0deg);
  box-shadow: 0 6px 20px rgba(0,0,0,.12);
}

/* Carta */
.letter{
  position:absolute; width:92%; height:86%; border-radius:16px; background:var(--paper);
  box-shadow: 0 10px 40px rgba(0,0,0,.18); z-index:1; display:grid; place-items:center; padding:22px;
  transform: translateY(18%) scale(.96); opacity:0; will-change:transform,opacity;
}
.letter__inner{ text-align:center; max-width:520px; }
.who{ font-size:1.15rem; margin:8px 0 18px; }
.title{ font-size:2rem; margin:0 0 8px; letter-spacing:.02em }
.meta{ color:#5b5b5b }

/* Sello */
.seal{ position:absolute; top:18%; left:50%; transform:translateX(-50%); z-index:4; pointer-events:none; }
.seal img, .seal svg{ width:96px; height:96px; display:block; filter: drop-shadow(0 6px 10px rgba(0,0,0,.25)); }

/* Animaciones */
.scene.open .seal{ animation: sealFade var(--dur-1) ease forwards; }
@keyframes sealFade{ to{ opacity:0; filter:blur(1px) drop-shadow(0 0 0 rgba(0,0,0,0)); } }

.scene.open .envelope__flap{
  animation: flapOpen var(--dur-2) var(--delay-s) cubic-bezier(.2,.7,.1,1) forwards;
}
@keyframes flapOpen{ to{ transform: rotateX(-178deg); box-shadow: 0 2px 10px rgba(0,0,0,.08);} }

.scene.open .letter{
  animation: letterRise var(--dur-3) calc(var(--dur-1) + var(--dur-2) + var(--delay-s)) cubic-bezier(.2,.7,.1,1) forwards;
}
@keyframes letterRise{
  0%{ transform: translateY(18%) scale(.96); opacity:0 }
  60%{ opacity:1 }
  100%{ transform: translateY(-6%) scale(1); opacity:1 }
}
.scene.open .letter--fill{
  animation: letterFill 700ms calc(var(--dur-1)+var(--dur-2)+var(--dur-3)+200ms) cubic-bezier(.2,.7,.1,1) forwards;
}
@keyframes letterFill{
  to{ width:100vw; height:92vh; max-height:92vh; border-radius:0; }
}

/* Reset (solo pruebas) */
.reset{ position:fixed; bottom:14px; right:14px; padding:8px 12px; border-radius:10px; background:#000; color:#fff; opacity:.08; border:0 }
.reset:hover{ opacity:.25 }

/* Responsive */
@media (max-width:520px){
  .title{ font-size:1.6rem }
  .who{ font-size:1rem }
  .seal img,.seal svg{ width:84px; height:84px }
}
